<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PHPEMS模拟考试系统</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.75, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" type="text/css" href="files/public/css/bootstrap.css" />
    <link rel="stylesheet/less" type="text/css" href="files/public/css/pe.less" />
    <link rel="stylesheet" href="files/public/css/swiper.min.css">
    <script src="files/public/js/less.min.js"></script>
    <script src="files/public/js/jquery.min.js"></script>
    <script src="files/public/js/swiper.min.js"></script>
    <script src="files/public/js/bootstrap.min.js"></script>
    <script src="files/public/js/bootstrap-datetimepicker.js"></script>
    <script src="files/public/js/all.fine-uploader.min.js"></script>
    <script src="files/public/js/ckeditor/ckeditor.js"></script>
    <script src="files/public/js/ckeditor/js/MathJax.js?config=TeX-AMS_HTML"></script>
    <!--
    <script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
    -->
    <script src="files/public/js/pe.app.js"></script>
    <script src="files/public/js/exam.app.js"></script>
</head>
<body>
<div class="container-fluid">
    <div class="row-fluid">
        <div class="pages">
            <div class="header navbar-fixed-top">
                <div class="nav">
                    <div class="col-xs-9">
                        <ul class="list-unstyled list-inline">
                            <li>
                                <h3 class="logo">UOJ</h3>
                            </li>
                        </ul>
                    </div>
                    <div class="col-xs-3">
                        <ul class="list-unstyled list-inline">
                            <li>
                                <h3 class="logo"><span id="timer_h">00</span>：<span id="timer_m">00</span>：<span id="timer_s">00</span></h3>
                            </li>
                            <li class="pull-right">
                                <a href="javascript:;" onclick="javascript:$('#submodal').modal();" class="menu">
                                    <span class="glyphicon glyphicon-print"></span> 交卷
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="content fixtop">
                <div class="col-xs-3">
                    <div class="content-box padding" id="questionindex" data-spy="affix">
                                                                                                                                                                                                                        <h3 class="title">
                            一、单选题                            <a class="badge pull-right resize"><em class="glyphicon glyphicon-resize-full"></em></a>
                        </h3>
                        <ul class="list-unstyled list-img">
                            <li id="qt_1">
                                                                                                                                                                <a id="sign_569" href="#q_569" class="btn btn-default qindex">1</a>
                                                                                                                                <a id="sign_570" href="#q_570" class="btn btn-default qindex">2</a>
                                                                                            </li>
                        </ul>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>
                </div>
                <form class="col-xs-9 nopadding" id="paper" action="index.php?exam-app-exampaper-score">
                                                                                                                                                                                                                                                <div class="content-box padding">
                        <h2 class="title">
                            <a id="q_569"></a>
                            第 1 题 【 单选题 】
                            <a class="badge pull-right favor" data-questionid="569">收藏</a>
                            <a class="badge pull-right" href="javascript:;" onclick="javascript:signQuestion('569',this);">标记</a>
                            <input id="time_569" type="hidden" name="time[569]"/>
                        </h2>
                        <ul class="list-unstyled list-img">
                            <li class="border morepadding">
                                <div class="desc">
                                    <p><p>十八大精神归结为一点，就是</p></p>
                                </div>
                            </li>
                                                                                    <li class="border morepadding">
                                <div class="desc">
                                    <p><p>A. 实现祖国统一</p>

<p>B. 坚持改革开放</p>

<p>C. 建设和谐社会</p>

<p>D. 坚持和发展中国特色社会主义</p></p>
                                </div>
                            </li>
                                                        <li class="border morepadding">
                                <div class="nopadding desc">
                                                                                                                                                <label class="inline"><input type="radio" name="question[569]" rel="569" value="A" /><span class="selector">A</span> </label>
                                                                                                            <label class="inline"><input type="radio" name="question[569]" rel="569" value="B" /><span class="selector">B</span> </label>
                                                                                                            <label class="inline"><input type="radio" name="question[569]" rel="569" value="C" /><span class="selector">C</span> </label>
                                                                                                            <label class="inline"><input type="radio" name="question[569]" rel="569" value="D" /><span class="selector">D</span> </label>
                                                                                                                                                                                </div>
                            </li>
                                                    </ul>
                    </div>
                                                                                <div class="content-box padding">
                        <h2 class="title">
                            <a id="q_570"></a>
                            第 2 题 【 单选题 】
                            <a class="badge pull-right favor" data-questionid="570">收藏</a>
                            <a class="badge pull-right" href="javascript:;" onclick="javascript:signQuestion('570',this);">标记</a>
                            <input id="time_570" type="hidden" name="time[570]"/>
                        </h2>
                        <ul class="list-unstyled list-img">
                            <li class="border morepadding">
                                <div class="desc">
                                    <p><p>中国的社会生产力在改革开放后迅速发展，到2012年经济总量已居世界</p></p>
                                </div>
                            </li>
                                                                                    <li class="border morepadding">
                                <div class="desc">
                                    <p><p>A. 第二位</p>

<p>B. 第三位</p>

<p>C. 第四位</p>

<p>D. 第五位</p></p>
                                </div>
                            </li>
                                                        <li class="border morepadding">
                                <div class="nopadding desc">
                                                                                                                                                <label class="inline"><input type="radio" name="question[570]" rel="570" value="A" /><span class="selector">A</span> </label>
                                                                                                            <label class="inline"><input type="radio" name="question[570]" rel="570" value="B" /><span class="selector">B</span> </label>
                                                                                                            <label class="inline"><input type="radio" name="question[570]" rel="570" value="C" /><span class="selector">C</span> </label>
                                                                                                            <label class="inline"><input type="radio" name="question[570]" rel="570" value="D" /><span class="selector">D</span> </label>
                                                                                                                                                                                </div>
                            </li>
                                                    </ul>
                    </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <input type="hidden" name="insertscore" value="1"/>
                    <input type="hidden" name="token" value="aadfe33fb1be10510d8d48bce630423b"/>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="submodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">交卷</h4>
            </div>
            <div class="modal-body">
                <p>共有试题 <span class="allquestionnumber">50</span> 题，已做 <span class="yesdonumber">0</span> 题。您确认要交卷吗？</p>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="javascript:submitPaper();" class="btn btn-primary">确定交卷</button>
                <button aria-hidden="true" class="btn" type="button" data-dismiss="modal">再检查一下</button>
            </div>
        </div>
    </div>
</div>
<script>
    $(function(){
        $.get('index.php?exam-app-index-ajax-lefttime&rand'+Math.random(),function(data){
            var setting = {
                time:60,
                hbox:$("#timer_h"),
                mbox:$("#timer_m"),
                sbox:$("#timer_s"),
                finish:function(){
                    submitPaper();
                }
            }
            setting.lefttime = parseInt(data);
            countdown(setting);
        });
        setInterval(saveanswer,120000);
    });
</script>
<div class="modal fade" id="submodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">交卷</h4>
            </div>
            <div class="modal-body">
                <p>共有试题 <span class="allquestionnumber">50</span> 题，已做 <span class="yesdonumber">0</span> 题。您确认要交卷吗？</p>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="javascript:submitPaper();" class="btn btn-primary">确定交卷</button>
                <button aria-hidden="true" class="btn" type="button" data-dismiss="modal">再检查一下</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="errormodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">错题举报</h4>
            </div>
            <div class="modal-body">
                <form action="index.php?exam-app-lesson-reporterror" method="post" class="form-horizontal" id="reporterrorform">
                    <fieldset>
                        <div class="form-group">
                            <label class="control-label col-xs-3">错误类型：</label>
                            <div class="col-xs-9">
                                <select class="form-control" name="args[fbtype]" needle="needle" msg="请选择错误类型">
                                    <option value="答案错误">答案错误</option>
                                    <option value="题干错误">题干错误</option>
                                    <option value="知识点归类错误">知识点归类错误</option>
                                    <option value="图片错误">图片错误</option>
                                    <option value="解析错误">解析错误</option>
                                    <option value="其他">其他</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-xs-12">
                                <textarea class="form-control" name="args[fbcontent]" rows="4" needle="needle" msg="请填写错误描述" placeholder="请填写错误描述"></textarea>
                                <input type="hidden" name="reporterror" value="1">
                                <input type="hidden" name="args[fbquestionid]" value="" id="fbquestionid">
                                <input type="hidden" name="page" value="">
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="javascript:$('#reporterrorform').submit();">提交</button>
            </div>
        </div>
    </div>
</div>
<script>
    $(function(){
        try{
            initData = $.parseJSON(storage.getItem('questions'));
            if(!initData)initData = new Object();
            for(k in initData){
                var v = initData[k];
                $('#time_'+k).val(v['time']);
                $(":radio[rel="+k+"]").each(function(){
                    var that = $(this);
                    if(v['value'] == that.val()){
                        that.attr("checked",true);
                    }
                });
                $("#paper :text[rel="+k+"],#paper textarea[rel="+k+"]").each(function(){
                    var that = $(this);
                    that.val(v['value']);
                    if(that.hasClass('jckeditor')){
                        CKEDITOR.instances[that.attr('id')].setData(v['value']);
                    }
                });
                $("#paper :checkbox[rel="+k+"]").each(function(){
                    var that = $(this);
                    if(v['value'].indexOf(that.val()) >= 0){
                        that.attr("checked",true);
                    }
                });
            }
        }catch(e){
            //
        }finally {
            markQuestions();
        }
        $('#paper :radio').on('click',function(){
            var that = $(this);
            setTimeout(function(){
                var now = Date.parse(new Date())/1000;
                $('#time_'+that.attr('rel')).val(now);
                initData[that.attr('rel')] = {value:that.val(),time:now};
                markQuestions();
            },100);
        });

        $('#paper :checkbox').on('click',function(){
            var that = $(this);
            setTimeout(function(){
                var now = Date.parse(new Date())/1000;
                var answer = '';
                $('#time_'+that.attr('rel')).val(now);
                that.parents('li').find(':checked').each(function(){
                    answer += $(this).val().toUpperCase();
                });
                initData[that.attr('rel')] = {value:answer,time:now};
                markQuestions();
            },100);
        });

        $('#paper :text,#paper textarea').on('blur',function(){
            var that = $(this);
            setTimeout(function(){
                var now = Date.parse(new Date())/1000;
                $('#time_'+that.attr('rel')).val(now);
                initData[that.attr('rel')] = {value:that.val(),time:now};
                markQuestions();
            },100);
        });

        $('body').delegate('.favor.badge','click',function() {
            favorquestion($(this).attr('data-questionid'));
        });

        $('body').delegate('.error.badge','click',function() {
            $('#fbquestionid').val($(this).attr('data-questionid'));
            $('#errormodal').modal();
        });

        $('body').delegate('#questionindex .resize','click',function(){
            var that = $(this);
            if(that.children('.glyphicon').hasClass('glyphicon-resize-full'))
            {
                $('#questionindex .resize .glyphicon').removeClass('glyphicon-resize-full').addClass('glyphicon glyphicon-resize-small');
                $('#questionindex').css('width','1226px');
            }
            else
            {
                $('#questionindex .resize .glyphicon').removeClass('glyphicon-resize-small').addClass('glyphicon glyphicon-resize-full');
                $('#questionindex').css('width','280px');
            }
        });

        $('body').delegate('#questionindex .qindex','click',function(){
            $('#questionindex .resize .glyphicon').removeClass('glyphicon-resize-small').addClass('glyphicon glyphicon-resize-full');
            $('#questionindex').css('width','280px');
        });

        $('.allquestionnumber').html($('#questionindex .qindex').length);
        $('.yesdonumber').html($('#questionindex .qindex.btn-primary').length);
    });
</script></body>
</html>
